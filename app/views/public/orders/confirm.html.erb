<div class="container">
<h3 class="my-3">注文情報確認</h3>

<div class="row">
  <div class="col-8">
  <table class="table table-sm table-bordered">
    <tr>
      <th>商品名</th>
      <th>単価（税込）</th>
      <th>数量</th>
      <th>小計</th>
    </tr>
    <% @cart_items.each do |cart_item| %>
      <tr>
        <td><%= attachment_image_tag(cart_item.products, :image, size: "60x50", fallback: "no_image.jpg") %>
            <%= cart_item.products.name %></td>
        <td><%= cart_item.products.price.to_s(:delimited)  %>円</td>
        <td><%= cart_item.quantity %></td>
        <td><%= cart_item.subtotal.to_s(:delimited) %>円</td>
      </tr>
    <% end %>
  </table>
  </div>

  <div class="col-4">
  <table class="table table-sm table-bordered">
    <%= form_for(@order, url: orders_path)do |f| %>
    <%# OrderedProductに送信 %>
      <% @cart_items.each do |cart_item| %>
        <%= f.fields_for :order_products do |ord| %>
          <%= ord.hidden_field :product_id, :value => cart_item.product.id %>
          <%= ord.hidden_field :quantity, :value => cart_item.quantity %>
          <%= ord.hidden_field :price, :value => cart_item.subtotal %>
      　<% end %>
      <% end %>
    　<tr>
        <th class="tablehead">送料</th>
        <td><%= @order.shipping_fee.to_s(:delimited) %>円</td>
            </tr>
            <tr>
              <th class="tablehead">商品合計</th>
              <td><%= @total_price.to_s(:delimited) %>円</td>
            </tr>

            <tr>
              <th class="tablehead">請求金額</th>
              <td><%= @order_total_price.to_s(:delimited) %>円</td>
            </tr>
      </table>
    </div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-2">
        <h6 class="font-weight-bold">支払方法</h6>
      </div>
      <div class="col-10">
        <p class="pt-2"><%= @order.payment_i18n %></p>
      </div>
    </div>

    <div class="row">
      <div class="col-2">
        <h6 class="font-weight-bold">お届け先</h6>
      </div>
      <div class="col-10 pt-2">
        <%= "〒" + @order.postal_code %>
        <%= @order.address %><br>
        <%= @order.name %>
      </div>
    </div>
  </div>

  <%# Orderに送信 %>
  <%= f.hidden_field :customer_id, :value => current_customer.id %>
  <%= f.hidden_field :name, :value => @order.name %>
  <%= f.hidden_field :postal_code, :value => @order.postal_code %>
  <%= f.hidden_field :address, :value => @order.address %>
  <%= f.hidden_field :total_price, :value => @order_total_price %>
  <%= f.hidden_field :payment %>

  <div class="row">
    <div class="col-3 offset-4 mt-3">
      <%= f.submit '購入を確定する', class: "btn btn-success" %>
    </div>
  </div>
  <% end %>

</div>